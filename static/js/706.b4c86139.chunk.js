"use strict";(self.webpackChunkformular_schema_editor=self.webpackChunkformular_schema_editor||[]).push([[706],{6706:(e,t,n)=>{n.r(t),n.d(t,{enforcePatternLibraryElementWrapping:()=>d,ensurePatternLibraryElement:()=>o,normalizeComplexStructure:()=>u,normalizeElementTypes:()=>s,validateFlowStructure:()=>a});var i=n(5852);const l={DateUIElement:{Y:"YEAR",M:"MONTH",D:"DAY",h:"HOUR",m:"MINUTE",YMD:"YMD",DATE:"DAY",TIME:"HOUR"},BooleanUIElement:{TOGGLE:"SWITCH",RADIO_BUTTON:"RADIO",CHECK:"CHECKBOX",BOOL:"CHECKBOX"},SingleSelectionUIElement:{BUTTON_GROUP:"BUTTONGROUP",RADIO_GROUP:"BUTTONGROUP",SELECT:"DROPDOWN",COMBOBOX:"DROPDOWN"},NumberUIElement:{INT:"INTEGER",FLOAT:"DOUBLE",DECIMAL:"DOUBLE",NUMBER:"INTEGER",REAL:"DOUBLE"},FileUIElement:{IMG:"IMAGE",PHOTO:"IMAGE",DOCUMENT:"FILE",DOC:"FILE",ATTACHMENT:"FILE"},TextUIElement:{TEXT:"PARAGRAPH",H1:"HEADING",H2:"HEADING",HEADER:"HEADING",TITLE:"HEADING",PLAIN:"PARAGRAPH"},StringUIElement:{TEXTAREA:"TEXT_AREA",INPUT:"TEXT",MULTILINE:"TEXT_AREA",SINGLE_LINE:"TEXT",PASSWORD:"PASSWORD",EMAIL:"EMAIL"},CustomUIElement:{SCANNER:"SCANNER",ADDRESS:"ADDRESS",LOCATION:"LOCATION",ADMIN_BOUNDARY:"ADMIN_BOUNDARY",ENVIRONMENT:"ENVIRONMENT"}},s=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=JSON.parse(JSON.stringify(e));n.id||(n.id=`flow_${(0,i.A)()}`),n.pages_edit||(n.pages_edit=[]),n.pages_view||(n.pages_view=n.pages_edit),n.pages_edit&&(n.pages_edit=n.pages_edit.map((e=>{if(e.id||(e.id=`page_${(0,i.A)()}`),e.title){if("string"===typeof e.title){const t=e.title;e.title={de:t,en:t}}}else e.title={de:"Neue Seite",en:"New Page"};return e.elements||(e.elements=[]),e.elements&&(e.elements=e.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)}))),e.sub_flows&&(e.sub_flows=e.sub_flows.map((e=>(e.type||(e.type="SUBFLOW"),e.elements||(e.elements=[]),e.elements&&(e.elements=e.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)}))),e)))),e}))),n.pages_view&&(n.pages_view=n.pages_view.map((e=>{if(e.id||(e.id=`page_${(0,i.A)()}`),e.title){if("string"===typeof e.title){const t=e.title;e.title={de:t,en:t}}}else e.title={de:"Neue Seite",en:"New Page"};return e.elements||(e.elements=[]),e.elements&&(e.elements=e.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)}))),e})));const l=a(n);return l.valid||console.warn("[normalizeElementTypes] Validierungsfehler:",l.errors),n},r=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return e;if(!e.pattern_type&&e.type)return e.elements&&(e.elements=e.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)}))),e;if(!e.pattern_type)return e;const n=e.pattern_type,s=l[n];if(t&&!e.field_id&&(console.log(`[normalizeElement] Erzeuge field_id f\xfcr ${n}`),e.field_id={field_name:`${n.toLowerCase()}_${(0,i.A)()}`}),e.title)if("string"===typeof e.title){const t=e.title;e.title={de:t,en:t}}else!e.title.de&&e.title.en?e.title.de=e.title.en:!e.title.en&&e.title.de&&(e.title.en=e.title.de);else e.title={de:`Neues ${n}`,en:`New ${n}`};if(["StringUIElement","NumberUIElement","DateUIElement","BooleanUIElement","SingleSelectionUIElement","FileUIElement"].includes(n)&&!e.description)e.description={de:"",en:""};else if(e.description&&"string"===typeof e.description){const t=e.description;e.description={de:t,en:t}}else e.description&&!e.description.de&&e.description.en?e.description.de=e.description.en:e.description&&!e.description.en&&e.description.de&&(e.description.en=e.description.de);return s&&e.type&&s[e.type]&&(e.type=s[e.type]),"FileUIElement"===n&&e.file_type&&s&&s[e.file_type]&&(e.file_type=s[e.file_type]),"FileUIElement"===n&&e.accepted_types&&!e.allowed_file_types&&(e.allowed_file_types=e.accepted_types,delete e.accepted_types),"SingleSelectionUIElement"===n&&e.items&&!e.options&&(e.options=e.items,delete e.items),"NumberUIElement"===n&&void 0!==e.default&&void 0===e.default_value&&(e.default_value=e.default,delete e.default),e.visibility_condition&&(e.visibility_condition=p(e.visibility_condition)),"GroupUIElement"===n&&e.elements||"ArrayUIElement"===n&&e.elements?e.elements=e.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)})):"CustomUIElement"===n?(e.elements&&(e.elements=e.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)}))),e.sub_flows&&(e.sub_flows=e.sub_flows.map((n=>(n.type||(n.type=e.type||"SUBFLOW"),n.elements&&(n.elements=n.elements.map((e=>e.element?{element:r(e.element,t)}:{element:r(e,t)}))),n))))):"ChipGroupUIElement"===n&&e.chips&&(e.chips=e.chips.map((e=>(e.pattern_type||(e.pattern_type="BooleanUIElement"),r(e,t))))),e},p=e=>e?Array.isArray(e)?e.map(p):("object"===typeof e&&(e.operator&&(e.operator=e.operator.toUpperCase(),["AND","OR"].includes(e.operator)&&e.conditions&&(e.conditions=e.conditions.map(p)),["EQ","NEQ","GT","GTE","LT","LTE","CONTAINS","NOT_CONTAINS"].includes(e.operator)&&e.field_id&&"string"===typeof e.field_id&&(e.field_id={field_name:e.field_id})),"LO"===e.type&&e.value?(e.operator=e.value.toUpperCase(),delete e.type,delete e.value,e.children&&(e.conditions=e.children.map(p),delete e.children)):"RFO"===e.type&&e.field&&e.operator&&("string"===typeof e.field?e.field_id={field_name:e.field}:e.field_id=e.field,delete e.field,delete e.type)),e):e,a=e=>{const t=[];return e?(e.id||t.push("Flow hat keine ID"),e.pages_edit&&Array.isArray(e.pages_edit)||t.push("Flow hat keine pages_edit oder pages_edit ist kein Array"),e.pages_view&&Array.isArray(e.pages_view)||t.push("Flow hat keine pages_view oder pages_view ist kein Array"),e.pages_edit&&e.pages_edit.forEach(((e,n)=>{e.id||t.push(`Seite ${n} hat keine ID`),e.title||t.push(`Seite ${n} hat keinen Titel`),e.elements&&Array.isArray(e.elements)||t.push(`Seite ${n} hat keine elements oder elements ist kein Array`),e.elements&&e.elements.forEach(((e,i)=>{if(e.element){const l=m(e.element,`Seite ${n}, Element ${i}`);t.push(...l)}else t.push(`Element ${i} auf Seite ${n} ist kein PatternLibraryElement`)})),e.sub_flows&&(Array.isArray(e.sub_flows)?e.sub_flows.forEach(((e,i)=>{e.type||t.push(`Subflow ${i} auf Seite ${n} hat keinen type`),e.elements&&Array.isArray(e.elements)||t.push(`Subflow ${i} auf Seite ${n} hat keine elements oder elements ist kein Array`),e.elements&&e.elements.forEach(((e,l)=>{if(e.element){const s=m(e.element,`Seite ${n}, Subflow ${i}, Element ${l}`);t.push(...s)}else t.push(`Element ${l} in Subflow ${i} auf Seite ${n} ist kein PatternLibraryElement`)}))})):t.push(`sub_flows auf Seite ${n} ist kein Array`))})),{valid:0===t.length,errors:t}):(t.push("Flow ist nicht definiert"),{valid:!1,errors:t})},m=(e,t)=>{const n=[];if(!e)return n.push(`${t}: Element ist nicht definiert`),n;switch(e.pattern_type||n.push(`${t}: Element hat keinen pattern_type`),"TextUIElement"===e.pattern_type||e.field_id||n.push(`${t}: Element hat keine field_id`),e.title?"object"!==typeof e.title||e.title.de&&e.title.en||n.push(`${t}: Element hat keinen vollst\xe4ndigen Titel (de/en)`):n.push(`${t}: Element hat keinen Titel`),e.pattern_type){case"GroupUIElement":case"ArrayUIElement":e.elements&&Array.isArray(e.elements)?e.elements.forEach(((e,i)=>{if(e.element){const l=m(e.element,`${t}, Unterelement ${i}`);n.push(...l)}else n.push(`${t}, Unterelement ${i}: Element ist kein PatternLibraryElement`)})):n.push(`${t}: ${e.pattern_type} hat keine elements oder elements ist kein Array`);break;case"CustomUIElement":e.sub_flows&&(Array.isArray(e.sub_flows)?e.sub_flows.forEach(((e,i)=>{e.type||n.push(`${t}, Subflow ${i}: Subflow hat keinen type`),e.elements&&Array.isArray(e.elements)?e.elements.forEach(((e,l)=>{if(e.element){const s=m(e.element,`${t}, Subflow ${i}, Element ${l}`);n.push(...s)}else n.push(`${t}, Subflow ${i}, Element ${l}: Element ist kein PatternLibraryElement`)})):n.push(`${t}, Subflow ${i}: Subflow hat keine elements oder elements ist kein Array`)})):n.push(`${t}: CustomUIElement hat sub_flows, aber sub_flows ist kein Array`));break;case"ChipGroupUIElement":e.chips&&Array.isArray(e.chips)?e.chips.forEach(((e,i)=>{e.pattern_type?"BooleanUIElement"!==e.pattern_type&&n.push(`${t}, Chip ${i}: Chip ist kein BooleanUIElement, sondern ${e.pattern_type}`):n.push(`${t}, Chip ${i}: Chip hat keinen pattern_type`),e.field_id||n.push(`${t}, Chip ${i}: Chip hat keine field_id`)})):n.push(`${t}: ChipGroupUIElement hat keine chips oder chips ist kein Array`);break;case"SingleSelectionUIElement":e.options&&Array.isArray(e.options)||n.push(`${t}: SingleSelectionUIElement hat keine options oder options ist kein Array`);break;case"FileUIElement":e.file_type||n.push(`${t}: FileUIElement hat keinen file_type`)}return n},o=e=>e&&e.element?e:{element:e},d=e=>{const t=JSON.parse(JSON.stringify(e));return t.pages_edit&&(t.pages_edit=t.pages_edit.map((e=>(e.elements&&(e.elements=e.elements.map((e=>o(e)))),e.sub_flows&&(e.sub_flows=e.sub_flows.map((e=>(e.elements&&(e.elements=e.elements.map((e=>o(e)))),e)))),e)))),t.pages_view&&(t.pages_view=t.pages_view.map((e=>(e.elements&&(e.elements=e.elements.map((e=>o(e)))),e)))),t},u=e=>{let t=s(e);t=d(t);const n=JSON.parse(JSON.stringify(t));n.pages_edit&&(n.pages_edit=n.pages_edit.map((e=>(e.elements&&(e.elements=E(e.elements)),e.sub_flows&&(e.sub_flows=e.sub_flows.map((e=>(e.type||(e.type="SUBFLOW"),e.elements&&(e.elements=E(e.elements)),e)))),e))));const i=a(n);return i.valid||console.warn("[normalizeComplexStructure] Validierungsfehler:",i.errors),n},E=e=>e.map((e=>{if(!e.element)return e;const t=e.element;return"GroupUIElement"===t.pattern_type&&t.elements||"ArrayUIElement"===t.pattern_type&&t.elements?t.elements=E(t.elements):"CustomUIElement"===t.pattern_type&&(t.elements&&(t.elements=E(t.elements)),t.sub_flows&&(t.sub_flows=t.sub_flows.map((e=>(e.type||(e.type=t.type||"SUBFLOW"),e.elements&&(e.elements=E(e.elements)),e))))),t.visibility_condition&&(t.visibility_condition=p(t.visibility_condition)),e}))}}]);
//# sourceMappingURL=706.b4c86139.chunk.js.map